---
- hosts: localhost
  vars_files: [group_vars/all]
  remote_user: root

  roles:
    - { role: ansible-xml }

  post_tasks:
      - name: Clean out modified xml file
        command: rm -f /tmp/foo2.xml

      - name: Copy in the example XML file
        command: cp foo.xml /tmp/foo2.xml

      - name: Verify task requires a valid 'file' attribute
        xml: xpath=/ file=/klfj/dlfjkldf/sojfkljf.xml
        ignore_errors: yes

      - name: Verify the module removes the 'rating' node
        xml: file=/tmp/foo2.xml xpath=/business/rating ensure=absent

      - name: Verify that Ansible detects mutually exclusive attributes (children & value)
        xml:
            file: /tmp/foo2.xml
            add_children:
                - child01
                - child02
            value: conflict!
        ignore_errors: yes

      - name: Add a badbeers element
        xml:
            file: /tmp/foo2.xml
            xpath: /business
            add_children:
                - badbeers

      - name: Add several more (bad) beers to the beers element, assuming a group_vars file with a 'bad_beers' variable in it
        xml:
            file: /tmp/foo2.xml
            xpath: /business/beers
            add_children: "{{ bad_beers }}"

      - name: Add several more (bad) beers to the beers element
        xml:
          file: /tmp/foo2.xml
          xpath: /business/beers
          add_children:
            - beer: "Old Rasputin"
            - beer: "Old Motor Oil"
            - beer: "Old Curmudgeon"